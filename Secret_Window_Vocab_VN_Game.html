<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Secret Window Vietnamese Meaning Game</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root {
      --bg:#f0f8ff;
      --card:#fff;
      --radius:10px;
      --shadow:0 8px 28px rgba(0,0,0,.06);
    }
    * {box-sizing:border-box;}
    body {
      margin:0;
      font-family: system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
      background: var(--bg);
      color:#1f2d3a;
      text-align:center;
      min-height:100vh;
      padding:16px;
    }
    .container {
      max-width: 960px;
      margin:auto;
      padding:12px;
    }
    h1 {
      font-size:1.9rem;
      margin:8px 0 4px;
    }
    #stage { font-weight:600; margin-bottom:6px; }
    .timer-wrap {
      display:flex;
      justify-content:center;
      align-items:center;
      gap:10px;
      margin:10px 0;
      flex-wrap:wrap;
    }
    .progress {
      width:240px;
      height:12px;
      background:#d9eafb;
      border-radius:6px;
      overflow:hidden;
    }
    .fill { height:100%; background:#ffb74d; width:0%; transition:width .2s; }
    #timeDisplay { font-size:.9rem; min-width:60px; }
    #memorizeBox {
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      justify-content:center;
      margin:12px 0;
    }
    .card {
      background: var(--card);
      border-radius: var(--radius);
      padding:14px 16px;
      width:260px;
      position:relative;
      text-align:left;
      box-shadow: var(--shadow);
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .word { font-weight:700; font-size:1.1rem; }
    .vn { font-size:.95rem; color:#555; }
    .emoji {
      font-size:2rem;
      position:absolute;
      top:8px;
      right:10px;
    }
    #prompt { margin:10px 0; font-size:1.1rem; }
    .windows {
      display:flex;
      gap:18px;
      flex-wrap:wrap;
      justify-content:center;
      margin:10px 0;
    }
    .window {
      background: #d9eafb;
      border:3px solid #007acc;
      border-radius:10px;
      width:160px;
      min-height:120px;
      position:relative;
      cursor:pointer;
      padding:12px 8px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      font-weight:600;
      font-size:.95rem;
      transition:transform .15s ease;
      user-select:none;
    }
    .window:focus { outline:3px solid #ffa500; }
    .window:hover { transform:scale(1.04); }
    .label {
      position:absolute;
      top:6px;
      left:6px;
      background:#007acc;
      color:white;
      padding:3px 7px;
      border-radius:5px;
      font-size:.6rem;
    }
    .translation { margin-top:6px; font-weight:600; }
    .emoji-big { font-size:1.8rem; margin-bottom:6px; }
    #feedback { margin:10px 0; min-height:24px; font-weight:600; }
    #scoreboard { margin-top:6px; font-size:.9rem; }
    #controls { margin:14px 0; display:flex; justify-content:center; gap:12px; flex-wrap:wrap; }
    button {
      padding:10px 18px;
      font-size:1rem;
      border:none;
      border-radius:8px;
      cursor:pointer;
      background:#1f6feb;
      color:white;
      font-weight:600;
      box-shadow:0 8px 24px rgba(31,110,235,.25);
      transition:filter .2s;
    }
    button:hover { filter:brightness(1.08); }
    .correct { border-color:#28a745 !important; background:#c8facc !important; }
    .wrong { border-color:#d63333 !important; background:#ffe3e3 !important; }
    #summary { margin-top:18px; padding:14px; background:#fff; border-radius:10px; box-shadow:var(--shadow); display:none; text-align:left; }
    small { color:#555; }
    .hidden { visibility:hidden; }
    @media (max-width: 800px){
      .card { width:100%; }
      .window { width:120px; }
    }
  </style>
</head>
<body>
  <div class="container" aria-label="Secret Window game container">
    <h1>Secret Window ‚Äì Ki·ªÉm tra nghƒ©a ti·∫øng Vi·ªát</h1>
    <div id="stage">Stage: <span id="stageName">Idle</span></div>
    <div class="timer-wrap">
      <div id="timeDisplay" aria-live="polite">--:--</div>
      <div class="progress" aria-label="Timer progress"><div class="fill" id="progressFill"></div></div>
    </div>
    <div id="memorizeBox" aria-label="Vocabulary to memorize"></div>
    <div id="prompt"></div>
    <div class="windows" id="windowsContainer" aria-label="Answer choices"></div>
    <div id="feedback" aria-live="polite"></div>
    <div id="scoreboard">Score: <span id="score">0</span> | Correct: <span id="correct">0</span> | Wrong: <span id="wrong">0</span></div>
    <div id="controls">
      <button id="startBtn">Start</button>
      <button id="nextBtn" disabled>Next</button>
    </div>
    <div id="summary" aria-label="Summary box"></div>
  </div>

  <!-- audio -->
  <audio id="tick" src="https://www.soundjay.com/clock/sounds/clock-ticking-3.mp3" loop preload="auto"></audio>
  <audio id="correctSound" src="https://www.soundjay.com/buttons/sounds/button-3.mp3" preload="auto"></audio>
  <audio id="clap" src="https://www.soundjay.com/human/sounds/applause-01.mp3" preload="auto"></audio>
  <audio id="wrongSound" src="https://www.soundjay.com/misc/sounds/fail-trombone-01.mp3" preload="auto"></audio>
  <audio id="bg" src="https://www.bensound.com/bensound-music/bensound-creativeminds.mp3" loop preload="auto"></audio>

  <script>
    // vocabulary
    const vocab = [
      { word: 'put out the rubbish', vn: 'v·ª©t r√°c ra ngo√†i', emoji: 'üóëÔ∏è' },
      { word: 'do the laundry', vn: 'gi·∫∑t qu·∫ßn √°o', emoji: 'üß∫' },
      { word: 'shop for groceries', vn: 'mua th·ª±c ph·∫©m', emoji: 'üõí' },
      { word: 'do the heavy lifting', vn: 'khi√™ng ƒë·ªì n·∫∑ng', emoji: 'üèãÔ∏è‚Äç‚ôÇÔ∏è' },
      { word: 'do the washing up', vn: 'r·ª≠a b√°t', emoji: 'üçΩÔ∏è' },
      { word: 'bread winner', vn: 'ng∆∞·ªùi tr·ª• c·ªôt ki·∫øm ti·ªÅn', emoji: 'üí∞' },
      { word: 'home maker', vn: 'ng∆∞·ªùi n·ªôi tr·ª£', emoji: 'üè†' },
      { word: 'take responsibility for', vn: 'ch·ªãu tr√°ch nhi·ªám', emoji: 'üìã' },
      { word: 'gratitude', vn: 'l√≤ng bi·∫øt ∆°n', emoji: 'üôè' },
      { word: 'strengthen', vn: 'tƒÉng c∆∞·ªùng', emoji: 'üí™' },
      { word: 'bonds', vn: 'm·ªëi quan h·ªá g·∫Øn b√≥', emoji: 'üîó' },
      { word: 'character', vn: 't√≠nh c√°ch', emoji: 'üë§' },
      { word: 'develop', vn: 'ph√°t tri·ªÉn', emoji: 'üå±' },
      { word: 'playtime', vn: 'th·ªùi gian ch∆°i', emoji: 'üß∏' },
      { word: 'necessary', vn: 'c·∫ßn thi·∫øt', emoji: '‚ö†Ô∏è' },
      { word: 'damage', vn: 'g√¢y h∆∞ h·∫°i', emoji: 'üí•' },
      { word: 'basic', vn: 'c∆° b·∫£n', emoji: 'üß±' },
      { word: 'housework', vn: 'vi·ªác nh√†', emoji: 'üßπ' },
      { word: 'divide', vn: 'chia', emoji: '‚ûó' },
      { word: 'equal', vn: 'b·∫±ng nhau', emoji: '‚öñÔ∏è' }
    ];

    // elements
    const stageName = document.getElementById('stageName');
    const memorizeBox = document.getElementById('memorizeBox');
    const promptEl = document.getElementById('prompt');
    const windowsContainer = document.getElementById('windowsContainer');
    const feedbackEl = document.getElementById('feedback');
    const scoreEl = document.getElementById('score');
    const correctEl = document.getElementById('correct');
    const wrongEl = document.getElementById('wrong');
    const timeDisplay = document.getElementById('timeDisplay');
    const progressFill = document.getElementById('progressFill');
    const summary = document.getElementById('summary');
    const startBtn = document.getElementById('startBtn');
    const nextBtn = document.getElementById('nextBtn');

    // audio
    const tick = document.getElementById('tick');
    const correctSound = document.getElementById('correctSound');
    const clap = document.getElementById('clap');
    const wrongSound = document.getElementById('wrongSound');
    const bg = document.getElementById('bg');
    bg.volume = 0.12;

    let score=0, correct=0, wrong=0;
    let currentTriple = [];
    let targetIndex=0;
    let stage='idle';
    let timerInterval=null;
    let totalTime=0;
    let withTick=false;
    let rounds=0;
    const maxRounds = 10;

    function shuffle(arr){ return arr.slice().sort(()=>Math.random()-0.5); }

    function setStage(name){ stageName.textContent=name; }

    function startMemorize(){
      if (rounds >= maxRounds) {
        finishSummary();
        return;
      }
      stage='memorize';
      setStage('H·ªçc v√† nh·ªõ');
      feedbackEl.textContent='';
      nextBtn.disabled=true;
      // increment round counter
      rounds++;
      // choose 3 random items
      currentTriple = shuffle(vocab).slice(0,3);
      targetIndex = Math.floor(Math.random()*3);
      // show cards
      memorizeBox.innerHTML='';
      currentTriple.forEach(o=>{
        const card = document.createElement('div');
        card.className='card';
        card.innerHTML = `<div class="emoji">${o.emoji}</div>
          <div class="word">${o.word}</div>
          <div class="vn">${o.vn}</div>`;
        memorizeBox.appendChild(card);
      });
      promptEl.textContent='Nh√¨n v√† ghi nh·ªõ nghƒ©a ti·∫øng Vi·ªát c·ªßa c√°c t·ª´. B·∫°n c√≥ 5 gi√¢y.';
      startTimer(5, ()=> startQuestion(), true);
    }

    function startQuestion(){
      stage='question';
      setStage('C√¢u h·ªèi');
      // hide memorize
      memorizeBox.innerHTML='';
      nextBtn.disabled=true;
      // choose target
      const target = currentTriple[targetIndex];
      promptEl.innerHTML = `T·ª´: <strong>${target.word}</strong><br><small>Ch·ªçn nghƒ©a ti·∫øng Vi·ªát ƒë√∫ng d∆∞·ªõi ƒë√¢y (ph√≠m A/B/C c≈©ng ƒë∆∞·ª£c)</small>`;
      // prepare options: correct vn plus two wrong randomly from other vocab
      const others = shuffle(vocab.filter(v=> v.word !== target.word));
      const choices = shuffle([ target, others[0], others[1] ]);
      windowsContainer.innerHTML='';
      choices.forEach((item,i)=>{
        const win = document.createElement('div');
        win.className='window';
        win.setAttribute('tabindex','0');
        win.setAttribute('role','button');
        win.setAttribute('aria-label', `Option ${String.fromCharCode(65+i)}: ${item.vn}`);
        win.dataset.correct = (item.word === target.word) ? 'true':'false';
        win.innerHTML = `<div class="label">${String.fromCharCode(65+i)}</div>
          <div class="emoji-big">${item.emoji}</div>
          <div class="translation">${item.vn}</div>`;
        win.addEventListener('click', ()=> selectAnswer(win));
        windowsContainer.appendChild(win);
      });
      feedbackEl.textContent='';
      startTimer(10, ()=> {
        feedbackEl.textContent='‚è∞ H·∫øt gi·ªù! ƒê√°p √°n ƒë∆∞·ª£c hi·ªÉn th·ªã.'; 
        revealAnswer(false);
      }, true);
    }

    function startTimer(seconds, onEnd, tickSound){
      clearInterval(timerInterval);
      totalTime=seconds;
      updateTimerDisplay(seconds, seconds);
      withTick = tickSound;
      if(tickSound){
        tick.currentTime=0;
        tick.play().catch(()=>{});
      }
      timerInterval = setInterval(()=>{
        totalTime--;
        if(totalTime<0){
          clearInterval(timerInterval);
          if(withTick){ tick.pause(); tick.currentTime=0; }
          updateTimerDisplay(0, seconds);
          onEnd();
          return;
        }
        updateTimerDisplay(totalTime, seconds);
      },1000);
    }

    function updateTimerDisplay(remain, total){
      const m = Math.floor(remain/60);
      const s = remain%60;
      timeDisplay.textContent = `${m}:${s<10?'0'+s:s}`;
      const pct = total === 0 ? 0 : (remain/total)*100;
      progressFill.style.width = pct + '%';
    }

    function selectAnswer(win){
      if(stage !== 'question') return;
      clearInterval(timerInterval);
      if(withTick){ tick.pause(); tick.currentTime=0; }
      const correctChoice = win.dataset.correct === 'true';
      revealAnswer(correctChoice, win);
    }

    function revealAnswer(isCorrect, selected=null){
      stage='feedback';
      setStage('Ph·∫£n h·ªìi');
      nextBtn.disabled=false;
      // highlight all
      const wins = Array.from(windowsContainer.querySelectorAll('.window'));
      wins.forEach(w=>{
        const correctFlag = w.dataset.correct==='true';
        if(correctFlag){
          w.classList.add('correct');
        }
        if(selected && w===selected && !isCorrect){
          w.classList.add('wrong');
        }
      });
      // update feedback and scores
      const target = currentTriple[targetIndex];
      if(isCorrect){
        feedbackEl.textContent = `‚úÖ Ch√≠nh x√°c! "${target.word}" nghƒ©a l√† "${target.vn}".`;
        score++; correct++;
        correctSound.currentTime=0;
        correctSound.play().catch(()=>{});
        setTimeout(()=>clap.play().catch(()=>{}), 350);
      } else {
        feedbackEl.textContent = `‚ùå Sai. ƒê√°p √°n ƒë√∫ng: "${target.vn}".`;
        score--; wrong++;
        wrongSound.currentTime=0;
        wrongSound.play().catch(()=>{});
      }
      updateScore();
      // if reached max rounds, adjust Next button label
      if(rounds >= maxRounds){
        nextBtn.textContent = 'Xem t·ªïng k·∫øt';
      } else {
        nextBtn.textContent = 'Next';
      }
    }

    function updateScore(){
      scoreEl.textContent=score;
      correctEl.textContent=correct;
      wrongEl.textContent=wrong;
    }

    function nextRound(){
      if(stage === 'feedback'){
        if(rounds >= maxRounds){
          finishSummary();
        } else {
          startMemorize();
        }
      }
    }

    function finishSummary(){
      stage='summary';
      setStage('K·∫øt th√∫c');
      summary.style.display='block';
      summary.innerHTML = `
        <strong>T·ªïng k·∫øt sau ${rounds} v√≤ng</strong><br>
        <ul>
          <li>ƒêi·ªÉm: ${score}</li>
          <li>ƒê√∫ng: ${correct}</li>
          <li>Sai: ${wrong}</li>
        </ul>
        <small>Nh·∫•n "Start" ƒë·ªÉ ch∆°i l·∫°i t·ª´ ƒë·∫ßu.</small>`;
      nextBtn.disabled=true;
    }

    // keyboard shortcuts A/B/C
    document.addEventListener('keydown', e=>{
      if(stage === 'question'){
        const key = e.key.toUpperCase();
        const mapping = { 'A':0, 'B':1, 'C':2 };
        if(key in mapping){
          const idx = mapping[key];
          const win = windowsContainer.children[idx];
          if(win){
            selectAnswer(win);
          }
        }
      }
    });

    startBtn.addEventListener('click', ()=>{
      // reset stats
      score=0; correct=0; wrong=0; rounds=0;
      updateScore();
      summary.style.display='none';
      feedbackEl.textContent='';
      nextBtn.disabled=true;
      startBtn.textContent='Restart';
      // start background music after user interaction
      bg.play().catch(()=>{});
      startMemorize();
    });

    nextBtn.addEventListener('click', ()=> nextRound());

    // initial state
    setStage('Ch∆∞a b·∫Øt ƒë·∫ßu');
    updateScore();
    timeDisplay.textContent='--:--';
    progressFill.style.width='0%';
  </script>
</body>
</html>
